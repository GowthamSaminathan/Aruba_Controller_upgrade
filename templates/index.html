<!DOCTYPE html>
<html lang="en">
<head>
  <title>Aruba Wireless Upgrade</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" crossorigin="anonymous">
  
  


<script src="static/papaparse.min.js"></script>


  
  <link rel="stylesheet" type="text/css" href="static/DataTables/datatables.min.css"/>
 
  <script type="text/javascript" src="static/DataTables/datatables.min.js"></script>

  <style>

.body {

  background-color: #ffffff;
}

.row_selected td {
    background-color: black !important; /* Add !important to make sure override datables base styles */
 }

#p2_device_table {
  counter-reset: row;
  /* Set the row counter to 0 */
}

#p2_device_table tr::before {
  counter-increment: row;
  /* Increment the row counter*/
  content: counter(row) ": ";
  /* Display the row */
}

.navbar_split_line:after {
    content: "|";
    position: absolute;
    top: 16px;
    margin-left: -10px;
}

</style>


</head>

<body overflow-x: hidden;>





<nav class="navbar navbar-expand-md navbar-light bg-light border-dark">
    <a href="#" class="navbar-brand">
        <img src="static/title.png" height="28" alt="CoolBrand" class="navbar_split_line">
    </a>
    
    <h5 class="navbar_split_line_"></h5>
    <h6 style="margin-top: 6px;"><span class="badge badge-light" style="margin-top: 8px; color: #21252994;">Aruba Wireless Upgrade</span></h6>

    <!--<h6 style="margin-top: 12px;"><span class="badge badge-info" id="total_clients">Total Clients : 5</span></h6>-->
    

    &nbsp;&nbsp;&nbsp;
    <div class="btn-group">
  <button type="button" class="btn btn-primary" id="upgrade" onclick="upgrade()">Home</button>
  
  <div class="btn-group">
    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" id="new_execution">
       Upgrade
    </button>
    <div class="dropdown-menu">
      <a class="dropdown-item" onclick="start_upgrade()">Start Upgrade</a>
      <a class="dropdown-item" onclick="new_execution()">Create New Upgrade POA</a>
      <a class="dropdown-item" onclick="manage_poa_list('list')">Manage Existing Upgrade POA</a>
    </div>
    <button type="button" class="btn btn-primary" id="history" onclick="show_history()">Upgrade History</button>
  </div>
</div>

    <div class="collapse navbar-collapse" id="navbarCollapse">
       
        <div class="navbar-nav ml-auto">
            <span class="badge badge-danger" id="load-status">Loading...</span>
        </div>
    </div>
</nav>
</br>





<!-- Select upgrade file -  Modal -->
  <div class="modal fade" id="select_upgrade">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Start new wireless upgrade</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
         
            <div class="container">
            <div class="row" style="margin-right: 0px"> 

            <div class="col-sm-12" style="background-color:#f8f9fa">
        
            <div class="form-group">
            <label for="sel1"><b>Select POA:</b></label>
            <select class="form-control" id="job_file_list">
              <option value="none">Please select</option>
            </select>
          </div>
            <div class="custom-control custom-switch">

            <input type="checkbox" class="custom-control-input" id="precheck_only" name="precheck">
            <label class="custom-control-label" for="precheck_only">Precheck only</label>
            </div>



            </div>
          </div>

          <div class="row" style="margin-right: 0px"> 

            <div class="col-sm-12" style="background-color:#f8f9fa">

            <div class="d-flex justify-content-end">
           
            <h6><span class="badge badge-danger" id="start_new_upgrade_badge"></span></h6>
             
            </div>

             <div class="d-flex justify-content-end">

              <button type="button" class="btn btn-warning btn-md" id="start_new_upgrade" onclick="start_new_upgrade()"><b id="start_new_upgrade_bold">Start Upgrade</b></button>
              
             </div>

          </div>
        </div>


          </div>

          

          </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>






<!-- Manage file -  Modal -->
  <div class="modal fade" id="manage_file">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">Manage POA</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
         
            <div class="container">
            <div class="row" style="margin-right: 0px"> 
            
            <div class="col-sm-6" style="background-color:#f8f9fa">
            <div class="form-group">
            <b><p>Select POA </p></b>
            <select class="form-control" id="select_poa">
              <option value="none">Please select</option>
            </select>
          </div>
          </div>

          <div class="col-sm-6" style="background-color:#f8f9fa">
              <p style="visibility:hidden;">Edit Download Delete</p>
              <button type="button" class="btn btn-warning btn-md" onclick="manage_poa_list('edit')"><i class="fa fa-edit" aria-hidden="true"></i></button>
              <button type="button" class="btn btn-primary btn-md" onclick="manage_poa_list('download')"><i class="fa fa-download" aria-hidden="true"></i></button>
              <button type="button" class="btn btn-danger btn-md" onclick="manage_poa_list('delete')"><i class="fa fa-trash" aria-hidden="true"></i></button>
            
         
          </div>
          

        <h5><span class="badge badge-light">
          Select Existing POA:
        </span></h5>

          <div class="d-flex justify-content-left">
          
          
         <form id="poa_upload_id" enctype="multipart/form-data">
          <input name="file" type="file" />
          <input type="button" value="Upload" />
        </form>



          
        </div>

          


          </div>
          </div>
          </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <div class="d-flex justify-content-end">
           
            <h6><span class="badge badge-warning" id="manage_poa_msg"></span></h6>
             
            </div>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>





<!-- Get user conformation -->
  <div class="modal fade" id="user_input">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header" >
          <h4 class="modal-title" id="user_input_head">Please confirm</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="user_input_body">
           <b><h5><span class="badge badge-light" id="user_input_msg"> </span></b><h5>
           <h6 id="user_input_eid" style="visibility: hidden;"><h6>
            <h6 id="user_input_name" style="visibility: hidden;"><h6>
           <button type="button" class="btn btn-warning btn-md" onclick="user_yes_no('yes')">Yes</button>&nbsp;&nbsp;&nbsp;
            <button type="button" class="btn btn-danger btn-md" onclick="user_yes_no('no')">No</button>


        </div>
        
      </div>
    </div>
  </div>


<!-- Get user conformation -->
  <div class="modal fade" id="user_input2">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header" >
          <h4 class="modal-title" id="user_input_head2">Precheck report</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="user_input_body2">
           
          <iframe id="user_input2_iframe"></iframe>

        </div>

        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-warning btn-md" onclick="user_yes_no('yes')">Continue</button>&nbsp;&nbsp;&nbsp;
          <button type="button" class="btn btn-danger btn-md" onclick="user_yes_no('no')">Cancel</button>
        </div>
        
      </div>
    </div>
  </div>




<!-- Get user async conformation -->
  <div class="modal fade" id="async_user_input">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header" >
          <h4 class="modal-title" id="async_user_input_head">Status</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="async_user_input_body">
           <b><h5><span class="badge badge-light" id="async_user_input_msg"> </span></b><h5>
           <h6 id="async_user_input_eid" style="visibility: hidden;"><h6>
            <h6 id="async_user_input_name" style="visibility: hidden;"><h6>
           <button type="button" class="btn btn-warning btn-md" onclick="async_user_yes_no('yes')">Skip this step</button>&nbsp;&nbsp;&nbsp;
            <button type="button" class="btn btn-danger btn-md" style="visibility: hidden;" onclick="async_user_yes_no('no')">No</button>


        </div>
        
      </div>
    </div>
  </div>


<!-- Show events model -->

<!-- Get user conformation -->
  <div class="modal fade" id="show_events">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header" >
          <h4 class="modal-title">Events</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
           <div class="container-fluid monitor-col upgrade_class" style="display: none;">
            <div class="row" style="margin-right: 0px"> 
            <div class="col-sm-12" style="background-color:#f8f9fa">
          <table id="execution_events_table" class="display compact hover " cellspacing="0"> </table>
        </div></div></div>

        </div>
        
      </div>
    </div>
  </div>












<div class="container-fluid monitor-col upgrade_class" style="display: none;">


<!-- Table -->
<div class="row" style="margin-right: 0px">
      
      <div class="col-sm-12">
        <table id="execution_table" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%"> 
        <tbody id="execution_body"></tbody>
        </table>
        <h6 id="job_name_id" style="visibility: hidden;"><h6>
      </div>
      
     
</div>

</div>





<!-- PAGE-2 Starts , ------------------------Creating New Execution form start hear -->


<div class="container new_execution_class" style="display: none;">

<!--<div class="d-flex justify-content-left">
<h5><span class="badge badge-info">Create New Execution</span></h5>
</div>-->

<!-- Upgrade name Row -->

<div class="row" style="margin-right: 0px">  
<div class="col-sm-12">

<div class="alert alert-danger alert-dismissible" id="save_fai_alert">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong>Failed!</strong> <p id="save_failed_alrt"></p>
</div>

<div class="alert alert-success alert-dismissible" id="save_suc_alert">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong>Success!</strong> <p id="save_success_alrt"></p>
</div>

<form>
  <div class="input-group mb-3 input-group-md">
     <div class="input-group-prepend">
       <span class="input-group-text" style="font-weight: bold">Upgrade Name</span>
    </div>
    <input type="text" class="form-control input-sm" placeholder="Ex: Change CRN20211" id="p2_upgrade_name">

  </div>
</form>

<form>
  <div class="input-group mb-3 input-group-md">
     <div class="input-group-prepend">
       <span class="input-group-text" style="font-weight: bold">AOS Source</span>
    </div>
    <select class="form-control input-sm"  id="p2_upgrade_source">
    <option>local</option>
    <option>tftp</option>
    <option>scp</option>
    <option>ftp</option>
  </select>
   <input type="text" class="form-control" placeholder="Host" id="p2_upgrade_host">
    <input type="text" class="form-control" placeholder="Path" id="p2_upgrade_path">
     <input type="text" class="form-control" placeholder="Username" id="p2_upgrade_uname">
      <input type="password" class="form-control" placeholder="Password" id="p2_upgrade_password">
      <input type="password" class="form-control" placeholder="confirm password" id="p2_upgrade_password2">
  </div>
</form>



</div>
</div>





<!-- MM details -->
<h6>MM New AOS Details:</h6>
<div class="row" style="margin-right: 0px">
      
<div class="col-sm-12">

<div class="table-responsive">
<table class="table table-striped table-sm">

<thead>

</thead>

<tbody>
<tr>
<td><input type="text" class="form-control input-sm" placeholder="MM AOS Filename" name="mm_aso_file" required="" id="p2_mm_aso_file"></td>
<td><input type="text" class="form-control input-sm" placeholder="Version" name="mm_aso_version" required="" id="p2_mm_aso_version"></td>
<td><input type="text" class="form-control input-sm" placeholder="Build" name="mm_aso_build" required="" id="p2_mm_aso_build"></td>

   
</tr>
</tbody>

</table>
</div>
</div>
</div>


<!-- MD details -->
<h6>MD New AOS Details:</h6>
<div class="row" style="margin-right: 0px">
      
<div class="col-sm-12">

<div class="table-responsive">
<table class="table  table-striped table-sm">

<thead>
<tr id="md_list_table">
</tr>
</thead>

<tbody>
<tr>
<td><input type="text" class="form-control" placeholder="MD AOS Filename" name="md_aso_file" required="" id="p2_md_aso_file"></td>
<td><input type="text" class="form-control" placeholder="Version" name="md_aso_version" required="" id="p2_md_aso_version"></td>
<td><input type="text" class="form-control" placeholder="Build" name="md_aso_build" required="" id="p2_md_aso_build"></td>


</tr>
</tbody>

</table>
</div>
</div>
</div>







<!-- host details -->
<h6>Upgrade Hosts</h6>
<div class="row" style="margin-right: 0px">
      
<div class="col-sm-12">

<div class="table-responsive">
<table class="table table-bordered table-sm" id="p2_upgrade_hosts_list">

<thead id="p2_new_host_rows">
<tr id="p2_new_host_row">
<!--<th>#</th>-->
<th>Device</th>
<th>Hostname</th>
<th>Host IP</th>
<!--<th>Custome</th>-->
<th>Remove/Add </th>
<button type="button" class="btn btn-light btn-sm" id="p2_show_excell_upload" onclick="host_excell_upload()" style="font-weight: bold;display:none">Upload hosts from CSV</button>
</tr>
</thead>

<tbody >
<tr>
   
</tr>
</tbody>

</table>
</div>
</div>
</div>

<form>
<div class="input-group mb-3 input-group-md">
   <div class="input-group-prepend">
     <span class="input-group-text" style="font-weight: bold;">Login Credential: </span>
  </div>
   <input type="text" class="form-control" placeholder="Username" id="p2_hosts_uname">
    <input type="password" class="form-control" placeholder="Password" id="p2_hosts_password">
    <input type="password" class="form-control" placeholder="confirm password" id="p2_hosts_password2">
</div>
</form>



<!-- Save , Modify reset Row -->
<div class="row" style="margin-right: 0px">
      
<div class="col-sm-12">


<div class="d-flex justify-content-center">
  <span class="badge badge-danger" id="save_danger"></span>
<span class="badge badge-success" id="save_success"></span>
</div>
<br>
</div>
</div>




<!-- Save , Modify reset Row -->
<div class="row" style="margin-right: 0px">
      
<div class="col-sm-12">


<div class="d-flex justify-content-center">
  <span class="badge badge-danger" id="save_danger"></span>
<span class="badge badge-success" id="save_success"></span>
  <button type="button" class="btn btn-primary" id="p2_custome_setting_exe" onclick="custome_settings()">Modify Custome Settings</button>&nbsp;&nbsp;&nbsp;
  <button type="button" class="btn btn-warning" id="p2_save_reset" onclick="new_execution()">Reset</button>&nbsp;&nbsp;&nbsp;
  <button type="button" class="btn btn-success" id="p2_save_all" onclick="save_execution()">Save All</button>
</div>
<br>
</div>
</div>


</div>


<!-- Page 2 Models start -->


<!-- Save  Modal -->
  <div class="modal fade" id="p2_save_status">
    <div class="modal-dialog modal-sm">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header" >
          <h4 class="modal-title" id="p2_save_status_title">Saving Status</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="p2_save_status_body">
           Please wait...
        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>


<!-- Modify Custome settings Modal -->
  <div class="modal fade" id="p2_custome_setting">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" id="p2_save_status_title">Modify Custome settings</h4>
          <h4 class="modal-title" id="p2_custome_setting_title"></h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="p2_custome_setting_body">

          <div class="table-responsive">
          <table class="table table-striped table-sm" >

          <thead>
          <tr>
          <th>Settings</th>
          <th>Status</th>
          <th>Note</th>
          </tr>
          </thead>

          <tbody >
          <tr>
            <td><h5><span class="badge badge-light">Maximum AP image load: </span></h5></td>
            <td><input type="number" value="10" min="1" max="1000" step="10" id="max_ap_preload" /></td>
            <td><span class="badge badge-light">Number of APs that can simultaneously download their image from the controller</span></td>
          </tr>

            <tr>
            <td><h5><span class="badge badge-light">Validate controller sync before upgrade: </span></h5></td>
            <td> <div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="v_c_s_b_u" name="example" enable>
            <label class="custom-control-label" for="v_c_s_b_u"></label>
            </div></td>
            <td> <span class="badge badge-light">Validate the controller switch sync status</span></td>
          </tr>

            <tr>
            <td><h5><span class="badge badge-light">Validate controller up before upgrade: </span></h5></td>
            <td> <div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="v_c_u_b_u" name="example">
            <label class="custom-control-label" for="v_c_u_b_u"></label>
            </div></td>
            <td> <span class="badge badge-light">Validate all the connected switch up/down status</span></td></tr>

            <td><h5><span class="badge badge-light">Backup flash before upgrade: </span></h5></td>
            <td><div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="b_f_b_u" name="example">
            <label class="custom-control-label" for="b_f_b_u"></label>
            </div> </td>
            <td><span class="badge badge-light">Recommended to backup the flash before upgrade</span></td></tr>

            <tr>
            <td><h5><span class="badge badge-light">Backup configuration before upgrade: </span></h5></td>
            <td><div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="b_c_b_u" name="example">
            <label class="custom-control-label" for="b_c_b_u"></label>
            </div></td>
            <td> <span class="badge badge-light">Recommended to backup the configuration before upgrade</span></td></tr>

            <tr>
            <td><h5><span class="badge badge-light">Backup license before upgrade: </span></h5></td>
            <td><div class="custom-control custom-switch">
            <input type="checkbox" class="custom-control-input" id="b_l_b_u" name="example">
            <label class="custom-control-label" for="b_l_b_u"></label>
            </div> </td>
            <td> <span class="badge badge-light">Recommended to backup the license before upgrade</span></td></tr>

            <tr>
            <td><h5><span class="badge badge-light">MM Checklist commands:</span></h5></td>
            <td><div class="form-group">
            
            <textarea class="form-control" rows="5" id="mm_precheck_cmd" style="width:250px;"></textarea>
            </div>
            </td>
            <td>
              <span class="badge badge-light">Collect the list of show command output before MM upgrade</span>
            </td></tr>

            <tr>
            <td><h5><span class="badge badge-light" >MD Checklist commands:</span></h5></td>
            <td><div class="form-group">
            
           <textarea class="form-control" rows="5" id="md_precheck_cmd" style="width:250px;"></textarea>
            </div>
            </td>
            <td>
              <span class="badge badge-light">Collect the list of show command output before MD upgrade</span>
            </td></tr>


          
          </tbody>

          </table>
          </div>
          
          
          
          
          

        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>



<!-- Edit host settings -->
  <div class="modal fade" id="p2_host_setting">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" id="p2_host_setting_title">Modify host settings</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="p2_host_setting_body">

        <div class="table-responsive">
        <table class="table table-striped table-sm">
        <thead>
        </thead>
        <tbody>
        <tr>
        <td ><select class="form-control input-sm" id="p2_host_device" data-live-search="true"><option>MM</option><option>MD</option><option>Select Device</option></select></td>
        <td><input type="text" class="form-control input-sm" placeholder="Host name" name="host_name" required="" id="p2_host_hostname"></td>
        <td><input type="text" class="form-control input-sm" placeholder="Host IP" name="host_ip" required="" id="p2_host_hostip"></td>
        </tr>
        </tbody>
        </table>
        </div>

        <div class="table-responsive">
        <table class="table table-striped table-sm">
        <thead>
        </thead>
        <tbody>
        <tr>
        <td><input type="text" class="form-control input-sm" placeholder="AOS Filename" name="p2_host_aso_file" required="" id="p2_host_aso_file"></td>
        <td><input type="text" class="form-control input-sm" placeholder="Version" name="p2_host_aso_version" required="" id="p2_host_aso_version"></td>
        <td><input type="text" class="form-control input-sm" placeholder="Build" name="p2_host_aso_build" required="" id="p2_host_aso_build"></td>
        </tr>
        </tbody>
        </table>
        </div>

        <form>
        <div class="input-group mb-3 input-group-sm">
           <div class="input-group-prepend">
             <span class="input-group-text" style="font-weight: bold;">Login Credential: </span>
          </div>
           <input type="text" class="form-control" placeholder="Username" id="p2_host_uname">
            <input type="password" class="form-control" placeholder="Password" id="p2_host_password">
        </div>
      </form>

        <!-- <form>
        <div class="input-group mb-3 input-group-sm">
           <div class="input-group-prepend">
             <span class="input-group-text">AOS Source</span>
          </div>
          <select class="form-control input-sm" id="p2_host_upgrade_source">
          <option>local</option>
          <option>tftp</option>
          <option>scp</option>
          <option>ftp</option>
        </select>
         <input type="text" class="form-control" placeholder="Host" id="p2_host_upgrade_host">
          <input type="text" class="form-control" placeholder="Path" id="p2_host_upgrade_path">
           <input type="text" class="form-control" placeholder="Username" id="p2_host_upgrade_uname">
            <input type="password" class="form-control" placeholder="Password" id="p2_host_upgrade_password">
        </div>
      </form> -->

        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>


<!-- upload Excell host settings -->
  <div class="modal fade" id="p2_excell_upload">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title" id="p2_excell_upload_title" style="font-weight: bold;">Import hosts from csv file</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body" id="p2_excell_upload_body">

         <!-- <div class="d-flex flex-row ">
          <div class="p-2"><h5><span class="badge badge-light">Download Excel template: </span></h5>
          </div>
          <div class="p-2"><button type="button" class="btn btn-primary btn-sm"><i class="fa fa-download" aria-hidden="true"></i></button></div>
          </div> -->

          <div class="d-flex flex-row ">
          <div class="p-2"><h5><span class="badge badge-light">Upload host's from csv:</span></h5></div>
          <div class="p-2">
            
            <input type="file" id="csv_file" name="filename2">
            <div class="mt-2">
            <button type="submit" class="btn btn-primary" onclick="import_from_csv()"> Submit</button>
            </div>

          </div>
          </div>


        </div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
          <span class="badge badge-danger" id="csv_import_status">Import failed</span>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div>



<!-- Page-2 End End of New Execution form -->


<!-- Pagge-3 Start : History -->

<div class="container monitor-col report_class">

<!-- Table -->
<div class="row" style="margin-right: 0px">
      
      <div class="col-sm-12">
        <h5><span class="badge badge-primary">Job History & Reports</span></h5>
        <div class="table-responsive">
        <table id="history_table" class="table table-striped table-sm table-striped table-bordered"  style="width:100%"> 
        <tbody id="history_table_body"></tbody>
        </table>
      </div>
      </div>

      <div class="col-sm-6">
        <div id="mymy"></div>
      </div>

</div>

</div>



<!-- Toaste -->

<div class="toast">
    <div class="toast-header">
      Toast Header
    </div>
    <div class="toast-body">
      Some text inside the toast body
    </div>
  </div>
</div>



<!-- Page-3 End : History -->




<script>


//////////////// PAGE -1 START ////////////////////////////////////////////// 

// Init the page-2
var dev_id = 0;
//new_execution();
upgrade();
//show_history();
//$(".report_class").show()
//$(".upgrade_class").hide()
//$(".new_execution_class").hide()


// Send user confirmation

function user_yes_no(ans){

eid = $("#user_input_eid").text()
ename = $("#user_input_name").text()
jdata = {"input":ans,"e_id":eid,"name":ename}
console.log(jdata);
$.ajax({
    type: 'POST',data:JSON.stringify(jdata),url: '/portal/yes_or_no',contentType: "application/json",dataType: 'json',    
    success:function(results){
      res_results = results["results"];



      if (res_results == "success"){

        $("#user_input_eid").text()
        $("#user_input_name").text()
        $(".user_yes_no").attr("id","tmp");
        $("#user_input").modal('hide');
        $("#user_input2").modal('hide');


      }

    } ,error: function(xhr, ajaxOptions, thrownError){

      console.log("** Server resonce - Yes no error");


    }});

}


function async_user_yes_no(ans){

eid = $("#async_user_input_eid").text()
ename = $("#async_user_input_name").text()
jdata = {"input":ans,"e_id":eid,"name":ename}
console.log(jdata);
$.ajax({
    type: 'POST',data:JSON.stringify(jdata),url: '/portal/async_yes_or_no',contentType: "application/json",dataType: 'json',    
    success:function(results){
      res_results = results["results"];



      if (res_results == "success"){

        $("#async_user_input_eid").text()
        $("#async_user_input_name").text()
        $(".async_user_yes_no").attr("id","tmp");
        $("#async_user_input").modal('hide');


      }

    } ,error: function(xhr, ajaxOptions, thrownError){

      console.log("** Server resonce - async - Yes no error");


    }});

}

function pause_stop_upgrade(ans){

if(ans == "P_or_RUNNING"){
console.log(ans);
ans = $("#P_or_RUNNING").text();
if ( ans == "Pause" ){ans="PAUSED";}
if ( ans == "Resume" ){ans="RUNNING";}

}
job_name = $("#job_name_id").text();
jdata = {"job_name":job_name,"status":ans}
console.log(ans);
$.ajax({
    type: 'POST',data:JSON.stringify(jdata),url: '/portal/job_manage',contentType: "application/json",dataType: 'json',    
    success:function(results){
      res_results = results["results"];

      console.log(results);

      if (res_results == "success"){

        if (results["message"] == "PAUSED"){$("#P_or_RUNNING").text("Resume");}
        if (results["message"] == "RUNNING"){$("#P_or_RUNNING").text("Pause");}


      }

    } ,error: function(xhr, ajaxOptions, thrownError){

      console.log("** Server resonce - pause_stop_upgrade");


    }});

}



// Adding action on creating new row in exection_table
function new_row_action( json ) 
{

try{
  console.log("jobs status update....")
  $("#message_1").text("");
  $("#message_2").text("");
  $("#message_3").text("");
  $("#message_4").text("");
  $("#message_5").text("");
  $("#message_4").attr('class', '');
  
  //console.log(json);
 
   // for ( var i=0, ien=json.length ; i<ien ; i++ ) 
    //{
    //    json[i][0] = '<a href="/message/'+json[i][0]+'>View message</a>';
      
    //}
  only_data = json["data"]



  if (jQuery.isEmptyObject(only_data) == false){
      
      job_name = json["job_name"];
      job_file = json["job_file"];
      job_status = json["job_status"];
      job_start_date = json["job_start_date"];
      job_end_date = json["job_end_date"];
      job_msg = json["job_msg"];


      if (job_status == "RUNNING") {
       $(".running_status_live").show();
       //$("#message_4").attr('class', 'spinner-border text-primary');
       $("#message_1").attr('class', 'badge badge-primary');

     }
      else if (job_status.indexOf("TERMINATE") == 0) {

        $(".running_status_live").hide();
        $("#message_1").attr('class', 'badge badge-danger');

      }
      else if (job_status == "COMPLETED") {

        $(".running_status_live").hide();
        $("#message_1").attr('class', 'badge badge-success');

      }else
      {
        $(".running_status_live").show();

      }

      if (job_status.indexOf("PAUSE") == 0){
        $(".running_status_live").show();
        $("#message_1").attr('class', 'badge badge-warning');
        $("#P_or_RUNNING").text("Resume")
      }
      else
        {
          $("#P_or_RUNNING").text("Pause")
        }

      message_1 = ""+job_status +": "+job_file
      if(job_msg == "None" || job_msg == ""){message_2 = "";}else{message_2 = job_msg;}
      
      //console.log(job_end_date);
      message_3 = "Started: "+job_start_date
      if(job_end_date == "" || job_end_date == "None"){}else{message_3 = message_3+ " Finished: "+job_end_date;}
      

      //$("#load-status").attr('class', 'badge badge-danger');
      $("#job_name_id").text(job_name);
      $("#message_1").text(message_1);
      $("#message_2").text(message_2);
      $("#message_3").text(message_3);
      $("#message_1").fadeOut("fast").fadeIn("fast");

      jQuery.each(only_data, function(i, val){
      status = val[5];
      style_val = 'style="text-align:left;white-space=nowrap"'

      //val[0] = '<span class="badge badge-secondary"'+style_val+'>'+val[0]+'</span>'
      val[1] = '<h5><span class="badge badge-primary"'+style_val+'>'+val[1]+'</span></h5>'
      val[2] = '<h6><span class="badge badge-light"'+style_val+'>'+val[2]+'</span></h6>'
      val[3] = '<h6><span class="badge badge-light"'+style_val+'>'+val[3]+'</span></h6>'
      val[4] = '<h6><span class="badge badge-light"'+style_val+'>'+val[4]+'</span></h6>'
      val[6] = '<h5><span class="badge badge-light"'+style_val+'>'+val[6]+'</span></h6>'

      if (status.indexOf("RUNNING") == 0)
      {

        if (job_status == "RUNNING")
        {

          val[5] = '<div class="spinner-border spinner-border-sm text-warning"></div><span class="badge badge-warning"'+style_val+'>'+val[5]+'</span>';

        }

        else
        {
        
        val[5] = '<span class="badge badge-warning"'+style_val+'>'+val[5]+'</span>';

        }
        //t = status + " " + val[6] + " - Host:"+val[2];
        //$("#message_5").text(t);
       

      }else if (status.indexOf("PENDING") == 0){

         val[5] = '<span class="badge badge-info"'+style_val+'>'+val[5]+'</span>'
        


      }else if (status.indexOf("COMPLETED") == 0){

         val[5] = '<span class="badge badge-success"'+style_val+'>'+val[5]+'</span>'
         

        
      }else {

        val[5] = '<span class="badge badge-danger"'+style_val+'>'+val[5]+'</span>'

      }

      });
      return only_data;

  }
else{
  $("#job_name_id").text();
  $("#message_1").text("");
  $("#message_2").text("");
  $("#message_3").text("");
  $("#message_4").text("");
  $("#message_4").attr('class', '');
  $("#message_5").text("");
  console.log("Job data not available......");
  console.log(json);
  $(".running_status_live").hide();
  return [];
}

}catch(e){
console.log("Receiving Job data error");
$("#job_name_id").text();
$("#message_5").text("");
$("#message_4").text("");
$("#message_4").attr('class', '');
$("#message_1").text("");
$("#message_2").text("");
$("#message_3").text("");
return []; 
}
}


/* $(document).ready(function() {
    $('#execution_table').DataTable( {
        "responsive": true,
        "select": true,
        "data": dataSet,
        "columns": [
            { title: "SNo"},
            { title: "Type" },
            { title: "Host" },
            { title: "Version" },
            { title: "Status" },
            { title: "Action" }
        ],
        "columnDefs": [{ "width": "1%", "targets": 0 }
        ],
        "scrollY":        "300px",
        "scrollCollapse": true,
        "paging":         false,
        "createdRow" : new_row_action

} );
});*/


$(document).ready(function() {
    execution_table = $('#execution_table').DataTable( {
        columns: [
            { title: "ID"},
            { title: "Device" },
            { title: "Host Name" },
            { title: "Host" },
            { title: "Upgrade Version" },
            { title: "Status" },
            { title: "Info" }

        ],
        //"buttons": [ 'copy', 'excel', 'pdf', 'colvis' ],
        lengthChange: false,
        //dom: 'Bfrtip',
        //dom:"<'row'<'col-sm-3'l><'col-sm-6 text-center'B><'col-sm-3'f>>" +"<'row'<'col-sm-12'tr>>" +"<'row'<'col-sm-5'i><'col-sm-7'p>>",
        "columnDefs": [{ "visible": false, "targets": [] }],
        "scrollY":        "400px",
        "scrollCollapse": true,
        "paging":         false,
        //"order": [[ 0, "desc" ]],
        "ajax": {
        "url": "/portal/read_last_job",
        "type": "GET",
        "dataSrc": new_row_action,
        },
        //buttons: ['copy','pdf','excel',{text: 'My button',action: function ( e, dt, node, config ) {alert( 'Button activated' );}}]
      
      });
     //execution_table.buttons().container().appendTo( $('div.eight.column:eq(0)', execution_table.table().container()) );

bar_1 = '<h5><span class="badge badge-primary" id="message_1"></span>&nbsp;'+
        '<span class="badge badge-light" id="message_2"></span></h5>'+
        '<h6><span class="badge badge-light" id="message_3"></span>&nbsp;</h6>'
          

bar_2 = '<button type="button" class="btn btn-warning running_status_live" style="top:3px;" id="P_or_RUNNING" onclick="pause_stop_upgrade('+"'P_or_RUNNING')"+
      '">Pause</button>&nbsp;'+
      '<button type="button" class="btn btn-danger running_status_live" style="top:3px;" onclick="pause_stop_upgrade('+"'TERMINATED')"+
      '"><b>Stop running</b></button>&nbsp;'+
      '<button type="button" class="btn btn-light" onclick="show_events()"><b>Events</b><span class="badge badge-warning"></span></button>&nbsp;'

//'<label>Search:<input type="search" class="form-control form-control-sm" placeholder="" aria-controls="execution_table"></label>'

//bar_2 = '<button type="button" class="btn btn-warning" style="top:3px;">Warning</button>&nbsp;'+
//'<button type="button" class="btn btn-danger" style="top:3px;">Danger</button>&nbsp;'

$("#execution_table_wrapper div:eq(1)").prepend(bar_1)
$("#execution_table_filter").prepend(bar_2)

} );


function modify_execution_table_data( json ) 
{

try{
  console.log("Reding Events response...")
  //console.log(json);
 
   // for ( var i=0, ien=json.length ; i<ien ; i++ ) 
    //{
    //    json[i][0] = '<a href="/message/'+json[i][0]+'>View message</a>';
      
    //}
  only_data = json["data"]
  if (jQuery.isEmptyObject(only_data) == false){
      jQuery.each(only_data, function(i, val){
      evnt_msg = val[3];
      val[2] = val[2].split(" ")[1];
      style_val = 'style="text-align:left;white-space=nowrap"'
      if (evnt_msg.indexOf("ERROR:") == 0)
      {

        val[2] = '<span class="badge badge-danger"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-danger"'+style_val+'>'+val[3]+'</span>'

      }else if (evnt_msg.indexOf("INFO:") == 0){

         val[2] = '<span class="badge badge-info"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-info"'+style_val+'>'+val[3]+'</span>'


      }else if (evnt_msg.indexOf("WARNING:") == 0){

         val[2] = '<span class="badge badge-warning"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-warning"'+style_val+'>'+val[3]+'</span>'

        
      }

      else if (evnt_msg.indexOf("IN:_Precheck") == 0){

         msg = val[3];
         val[2] = '<span class="badge badge-primary"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-primary"'+style_val+'>'+val[3]+'</span>'
        
         if(only_data.length == i+1)
         {

          
          msg = msg.split("IN:")[1];
          $("#user_input_msg").text(msg);
          console.log("User Input required : "+msg);
          $("#user_input_eid").text(val[4]);
          $("#user_input_name").text(val[1]);
          
          if (($("#user_input2").data('bs.modal') || {})._isShown != true){
          pre_url = "/portal/get_report?job_name="+val[1]+"&report_name=Precheck.html"
          console.log(pre_url)
          if_d = '<iframe src="'+pre_url+'" style="display:block;height: 65vh;width:80vw;border:none;"></iframe>'
          $("#user_input_body2").html(if_d);

          $("#user_input2").modal({backdrop: "static"});

        }

         }

        
      }
      else if (evnt_msg.indexOf("IN:") == 0){

         msg = val[3];
         val[2] = '<span class="badge badge-primary"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-primary"'+style_val+'>'+val[3]+'</span>'
        
         if(only_data.length == i+1)
         {

          
          msg = msg.split("IN:")[1];
          $("#user_input_msg").text(msg);
          console.log("User Input required : "+msg);
          $("#user_input_eid").text(val[4]);
          $("#user_input_name").text(val[1]);
          $("#user_input").modal({backdrop: "static"});

         }

        
      }
      else{

        val[2] = '<span class="badge badge-warning"'+style_val+'>'+val[2]+'</span>'
         val[3] = '<span class="badge badge-warning"'+style_val+'>'+val[3]+'</span>'

      }

      });
      return only_data;

  }
else{
  console.log("Events data not found")
  console.log(json);
  return [];
}

}catch(e){console.log("Receiving Events error");return [];}}

$(document).ready(function() {
    events_table = $('#execution_events_table').DataTable( {
        columns: [
            { title: "ID" },
            { title: "NAME" },
            { title: "TIME" },
            { title: "EVENTS" },
            { title: "EID" }

        ],
         dom: 'Bfrtip',
        buttons: ['copy', 'excel'],
        "columnDefs": [{ "visible": false, "targets": [0,1,4] }],
        "scrollY":        "400px",
        "order": [[ 0, "desc" ]],
        "scrollCollapse": true,
        "paging":         false,
        //"order": [[ 0, "desc" ]],
        "ajax": {
        "url": "/portal/read_last_events",
        "type": "GET",
        "dataSrc": modify_execution_table_data,
        }
      
      });

} );

function show_events(){

$("#show_events").modal({backdrop: "static"});

}

//Set error in badge-danger
function server_live_error(xhr, ajaxOptions, thrownError){

$("#load-status").attr('class', 'badge badge-danger');
$("#load-status").text("Server Connection Error");
$("#load-status").fadeOut("fast").fadeIn("fast");


}


//Set Live
function server_live(xhr, ajaxOptions, thrownError){

$("#load-status").attr('class', 'badge badge-success');
$("#load-status").text("Online");
$("#load-status").fadeOut("fast").fadeIn("fast");

}

// Get the server live status
function get_server_status(){

try{

//console.log("Getting server Live status")

$.ajax({
    type: 'GET',url: '/portal/status',contentType: false,cache: false,processData:false,
    success: server_live,error: server_live_error})

}catch(err){console.log("** ==>Error get_server_status: "+err);}}


// Upgrade function
function upgrade(){

$(".report_class").hide()
$(".new_execution_class").hide()
$(".upgrade_class").show()

$("#upgrade").attr('class', 'btn btn-outline-primary active');
$("#new_execution").attr('class', 'btn btn-outline-primary dropdown-toggle');
$("#history").attr('class', 'btn btn-outline-primary');
$(".upgrade_class").show()


}





function equalArray(a, b) {
    try{
    //console.log(a)
    //console.log(b)
    return JSON.stringify(a) == JSON.stringify(b);
  }catch(e){console.log(e);}
}





// Action on selected execution table
function action_select(){

var ex_table = $('#execution_table').dataTable();
selected_data = ex_table.rows('.selected').data();
//console.log(selected_data);

}




function execute_list(odd_even,t_data){
  sno = t_data[0];
  h_type = t_data[1];
  host_name = t_data[2];
  host_ip = t_data[3];
  version = t_data[4];
  status = t_data[5];

  host = host_name +" "+ host_ip

  make_table = (odd_even,t_data) =>
    `
    <tr role="row" class="${odd_even}">
    <td class="sorting_1 dtr-control" id="sno_${sno}">${sno}</td>
    <td id="dtype_${sno}"${h_type}</td>
    <td id="host_${sno}">${host}</td>
    <td id="version_${sno}">${version}</td>
    <td id="status_${sno}">${status}</td>
    <td id="act_${sno}">
    <button class="badge badge-secondary" onclick="exe_action('${sno}')" id="action_${sno}">
    <i class="fas fa-pause"></i>
    </button>
    </td>
    </tr>
    `
  return make_table(odd_even,t_data)
}


function async_get_events(){

$.ajax({
    type: 'GET',url: '/portal/async_read_last_events', contentType: false,cache: false,processData:false,   
    success:function(results)
{
      

  only_data = results["data"]
  //console.log(only_data);
  if (jQuery.isEmptyObject(only_data) == false){
          val = only_data;
          console.log(only_data);
          msg = val[3]
          if (msg.indexOf("ASYNC_IN:") == 0)
          {

          msg = msg.split("ASYNC_IN:")[1];
          $("#async_user_input_msg").text(msg);
          console.log("User Input required : "+msg);
          $("#async_user_input_eid").text(val[4]);
          $("#async_user_input_name").text(val[1]);
          $("#async_user_input").modal({backdrop: "static"});

        }
        
      
      }



},error: function(xhr, ajaxOptions, thrownError){


      $("#start_new_upgrade_badge").attr('class', 'badge badge-danger');
      $("#start_new_upgrade_badge").text("Failed to reach...");
      console.log("** Failed to update async yes_no....");

}});





}




//////////////// PAGE -1 END /////////////////////////////////////////////////

//////////////// PAGE -2 START ////////////////////////////////////////////// 


$("#precheck_only").click(function() {
if($("#precheck_only").prop("checked")){

  $("#start_new_upgrade_bold").text("Start Precheck");

}else{$("#start_new_upgrade_bold").text("Start Upgrade");}
});


$('#poa_upload_id').on('click', function () {
  $("#manage_poa_msg").text("Uploading...");
  $.ajax({
    // Your server script to process the upload
    url: '/portal/upload_yaml',
    type: 'POST',
    success:function(results){
      manage_poa_list("list")
    $("#manage_poa_msg").text(results["message"]);
    },

    // Form data
    data: new FormData($('form')[0]),

    // Tell jQuery not to process data or worry about content-type
    // You *must* include these options!
    cache: false,
    contentType: false,
    processData: false,

    // Custom XMLHttpRequest
  });
});


// AOS source selection action
$(document).ready(function(){
  $("#p2_upgrade_source").click(function(){

    s_v = $(this).val();
    if (s_v == "ftp"){

      $("#p2_upgrade_host").show();
      $("#p2_upgrade_path").show();
      $("#p2_upgrade_uname").show();
      $("#p2_upgrade_password").show();
      $("#p2_upgrade_password2").show();

    }else if (s_v == "tftp"){

      $("#p2_upgrade_host").show();
      $("#p2_upgrade_path").show();
      $("#p2_upgrade_uname").hide();
      $("#p2_upgrade_password").hide();
      $("#p2_upgrade_password2").hide();

    }else if (s_v == "local"){

      $("#p2_upgrade_host").show();
      $("#p2_upgrade_path").show();
      $("#p2_upgrade_uname").hide();
      $("#p2_upgrade_password").hide();
       $("#p2_upgrade_password2").hide();

    }else if (s_v == "scp"){

      $("#p2_upgrade_host").show();
      $("#p2_upgrade_path").show();
      $("#p2_upgrade_uname").show();
      $("#p2_upgrade_password").show();
      $("#p2_upgrade_password2").show();

    }
  

  });
});


function new_device_list(id_name,t_data){

mm_device = "";
md_device = "";
hostname = "";
hostip = "";

//<td><button class="btn btn-primary btn-sm rounded-0" type="button" data-toggle="tooltip" data-placement="top" title="Edit" onclick="host_settings(${id_name})"><i class="fa fa-edit"></i></button></td>


if(t_data["device"] == "MM")
{
mm_device = 'selected="selected"'
}

if(t_data["device"] == "MD")
{
md_device = 'selected="selected"'
}

if(t_data["hostname"] != undefined)
{
hostname = t_data["hostname"]
}

if(t_data["hostip"] != undefined)
{
hostip = t_data["hostip"]
}



  make_device_table = (id_name,mm_device,md_device,hostname,hostip) =>
    `

<tr role="row" id="${id_name}_new_device">

<td ><select class="form-control input-sm" id="${id_name}_device" data-live-search="true"><option ${mm_device}>MM</option><option ${md_device}>MD</option><option>Select Device</option>MD</select></td>

<td><input value="${hostname}" type="text" class="form-control input-sm" placeholder="Host name" name="host_name" required="" id="${id_name}_hostname"></td>

<td><input value="${hostip}" type="text" class="form-control input-sm" placeholder="Host IP" name="host_ip" required="" id="${id_name}_hostip"></td>


<td><ul class="list-inline m-0">
<li class="list-inline-item">
</li>
<li class="list-inline-item">
<button class="btn btn-danger btn-sm rounded-0" type="button" data-toggle="tooltip" data-placement="top" title="Delete" onclick="delete_device('${id_name}_new_device')"><i class="fa fa-trash"></i></button>
</li>
<button class="btn btn-success btn-sm rounded-0" type="button" data-toggle="tooltip" data-placement="top" title="Add" onclick="add_new_device('${id_name}_new_device','')"><i class="fa fa-plus"></i></button>

</ul></td>

</tr>`

  return make_device_table(id_name,mm_device,md_device,hostname,hostip)
}



function reset_settings(){

$(".alert").alert('close')
console.log("Resetting host settings....")
//$("#p2_upgrade_hosts_list").empty();
$("#p2_new_host_rows").find("tr:gt(0)").remove();
$("#p2_upgrade_name").val("");

$("#p2_upgrade_host").val("");
$("#p2_upgrade_path").val("");
$("#p2_upgrade_uname").val("");
$("#p2_upgrade_password").val("");
$("#p2_upgrade_password2").val("");

$("#p2_mm_aso_file").val("");
$("#p2_mm_aso_version").val("");
$("#p2_mm_aso_build").val("");

$("#p2_md_aso_file").val("");
$("#p2_md_aso_version").val("");
$("#p2_md_aso_build").val("");

$("#p2_hosts_uname").val("");
$("#p2_hosts_password").val("");
$("#p2_hosts_password2").val("");

$("#save_danger").text("");
$("#save_success").text("");

}


function add_data_to_execution_form(data){

// Empty all data


try{

if(data["results"] == "success"){

data = data["data"]


default_settings = data["default_settings"];
//console.log(default_settings);
Upgrade = data["Upgrade"];

AOS_Source = default_settings["AOS_Source"];
Authentication = default_settings["Authentication"];
MM = default_settings["MM"];
MD = default_settings["MD"];
Validate_Image_before_upgrade = default_settings["Validate_Image_before_upgrade"];
Validate_controller_sync_before_upgrade = default_settings["Validate_controller_sync_before_upgrade"];
Validate_controller_up_before_upgrade = default_settings["Validate_controller_up_before_upgrade"];
mm_checklist = MM["CheckList"];
md_checklist = MD["CheckList"];
mm_checklist_d = ""
md_checklist_d = ""

jQuery.each(mm_checklist,function (i , val){

mm_checklist_d = mm_checklist_d+"\n"+val["show"];

});

jQuery.each(md_checklist,function (i , val){

md_checklist_d = md_checklist_d+"\n"+val["show"];

});


$("#mm_precheck_cmd").val(mm_checklist_d.trim());
$("#md_precheck_cmd").val(md_checklist_d.trim());

// Default AOS source
if(jQuery.isEmptyObject(AOS_Source) == false){
aos_source_device_type = AOS_Source["device_type"];



aos_source_local_path = AOS_Source["local_path"];

aos_source_ftp_host = AOS_Source["ftp_host"];
aos_source_ftp_username = AOS_Source["ftp_username"];
aos_source_ftp_password = AOS_Source["ftp_password"];
aos_source_ftp_path = AOS_Source["ftp_path"];

aos_source_scp_host = AOS_Source["scp_host"];
aos_source_scp_username = AOS_Source["scp_username"];
aos_source_scp_password = AOS_Source["scp_password"];
aos_source_scp_path = AOS_Source["scp_path"];

aos_source_tftp_host = AOS_Source["tftp_host"];
aos_source_tftp_path = AOS_Source["tftp_path"];

if(aos_source_device_type == "local")
{
$("#p2_upgrade_source").val("local");
$("#p2_upgrade_path").val(aos_source_local_path);
}

if(aos_source_device_type == "ftp")
{
$("#p2_upgrade_source").val("ftp");
$("#p2_upgrade_host").val(aos_source_ftp_host);
$("#p2_upgrade_path").val(aos_source_ftp_path);
$("#p2_upgrade_uname").val(aos_source_ftp_username);
$("#p2_upgrade_password").val(aos_source_ftp_password);
$("#p2_upgrade_password2").val(aos_source_ftp_password);
}

if(aos_source_device_type == "scp")
{
$("#p2_upgrade_source").val("scp");
$("#p2_upgrade_host").val(aos_source_scp_host);
$("#p2_upgrade_path").val(aos_source_scp_path);
$("#p2_upgrade_uname").val(aos_source_scp_username);
$("#p2_upgrade_password").val(aos_source_scp_password);
$("#p2_upgrade_password2").val(aos_source_scp_password);
}

if(aos_source_device_type == "tftp")
{
$("#p2_upgrade_source").val("tftp");
$("#p2_upgrade_host").val(aos_source_tftp_host);
$("#p2_upgrade_path").val(aos_source_tftp_path);
}
}


if(jQuery.isEmptyObject(MM) == false)
{

$("#p2_mm_aso_file").val(MM["image_file_name"]);
$("#p2_mm_aso_version").val(MM["image_version"]);
$("#p2_mm_aso_build").val(MM["image_build"]);

}

if(jQuery.isEmptyObject(MD) == false)
{

$("#p2_md_aso_file").val(MD["image_file_name"]);
$("#p2_md_aso_version").val(MD["image_version"]);
$("#p2_md_aso_build").val(MD["image_build"]);

}

if(jQuery.isEmptyObject(Authentication) == false)
{

$("#p2_hosts_uname").val(Authentication["username"]);
$("#p2_hosts_password").val(Authentication["password"]);
$("#p2_hosts_password2").val(Authentication["password"]);

}

if(jQuery.isEmptyObject(Authentication) == false)
{

$("#p2_hosts_uname").val(Authentication["username"]);
$("#p2_hosts_password").val(Authentication["password"]);
$("#p2_hosts_password2").val(Authentication["password"]);

}

if(jQuery.isEmptyObject(Upgrade) == false)
{

jQuery.each(Upgrade, function(i, val){

hostname = val["hostname"];
device_type = val["device_type"];
host = val["host"];
d ={};
d["device"] = device_type;
d["hostname"] = hostname;
d["hostip"] = host;
if (i == 0){add_new_device(i+1,d);}else{
add_new_device(i+"_new_device",d);}


});

}

}else{


}

//console.log(data);
$(".upgrade_class").hide();
$(".report_class").hide();
$(".new_execution_class").show();

$("#upgrade").attr('class', 'btn btn-outline-primary');
$("#new_execution").attr('class', 'btn btn-outline-primary active dropdown-toggle');
$("#history").attr('class', 'btn btn-outline-primary');


// Add one new device 


}catch(e){console.log(e);}


}


function save_execution(){


file_name = $("#p2_upgrade_name").val();

file_name = file_name.trim();

if(file_name.length < 1)
{$("#save_danger").text("Please provide valid upgrade name");return "";}

aos_source = $("#p2_upgrade_source").val();

if(aos_source == "local")
{
source_server = $("#p2_upgrade_source").val();
source_server_path = $("#p2_upgrade_path").val();
AOS_Source = {"device_type":source_server,"local_path":source_server_path}

    if(source_server.length < 1)
      {$("#save_danger").text("Please provide valid AOS source server");return "";}
    if(source_server_path.length < 1)
      {$("#save_danger").text("Please provide valid AOS source server path");return "";}


}

if(aos_source == "ftp")
{
source_server = $("#p2_upgrade_source").val();
source_server_host = $("#p2_upgrade_host").val();
source_server_path = $("#p2_upgrade_path").val();
source_server_uname = $("#p2_upgrade_uname").val();
source_server_pass = $("#p2_upgrade_password").val();
source_server_pass2 = $("#p2_upgrade_password2").val();

if(source_server_pass != source_server_pass2)
{$("#save_danger").text("FTP Server Password not matched");return "";}

if(source_server_pass != source_server_pass2)
{$("#save_danger").text("SCP Server Password not matched");return "";}

AOS_Source = {"device_type":source_server,"ftp_host":source_server_host,"ftp_username":source_server_uname,"ftp_password":source_server_pass,"ftp_path":source_server_path}

   if(source_server.length < 1)
      {$("#save_danger").text("Please provide valid AOS source server");return "";}
    if(source_server_path.length < 1)
      {$("#save_danger").text("Please provide valid AOS ftp server path");return "";}
    if(source_server_host.length < 1)
      {$("#save_danger").text("Please provide valid AOS ftp server");return "";}
    if(source_server_uname.length < 1)
      {$("#save_danger").text("Please provide valid AOS ftp server username");return "";}
    if(source_server_pass.length < 1)
      {$("#save_danger").text("Please provide valid AOS ftp server password");return "";}


}

if(aos_source == "scp")
{
source_server = $("#p2_upgrade_source").val();
source_server_host = $("#p2_upgrade_host").val();
source_server_path = $("#p2_upgrade_path").val();
source_server_uname = $("#p2_upgrade_uname").val();
source_server_pass = $("#p2_upgrade_password").val();
source_server_pass2 = $("#p2_upgrade_password2").val();

if(source_server_pass != source_server_pass2)
{$("#save_danger").text("SCP Server Password not matched");return "";}

AOS_Source = {"device_type":source_server,"scp_host":source_server_host,"scp_username":source_server_uname,"scp_password":source_server_pass,"scp_path":source_server_path}

   if(source_server.length < 1)
      {$("#save_danger").text("Please provide valid AOS source server");return "";}
    if(source_server_path.length < 1)
      {$("#save_danger").text("Please provide valid AOS SCP server path");return "";}
    if(source_server_host.length < 1)
      {$("#save_danger").text("Please provide valid AOS SCP server");return "";}
    if(source_server_uname.length < 1)
      {$("#save_danger").text("Please provide valid AOS SCP server username");return "";}
    if(source_server_pass.length < 1)
      {$("#save_danger").text("Please provide valid AOS SCP server password");return "";}

}





if(aos_source == "tftp")
{
source_server = $("#p2_upgrade_source").val();
source_server_host = $("#p2_upgrade_host").val();
source_server_path = $("#p2_upgrade_path").val();
AOS_Source = {"device_type":source_server,"tftp_host":source_server_host,"tftp_path":source_server_path}

  if(source_server.length < 1)
      {$("#save_danger").text("Please provide valid AOS source server");return "";}
    if(source_server_path.length < 1)
      {$("#save_danger").text("Please provide valid AOS TFTP server path");return "";}
    if(source_server_host.length < 1)
      {$("#save_danger").text("Please provide valid AOS TFTP server");return "";}


}


max_ap_preload = $("#max_ap_preload").val();
md_precheck_cmd = $("#md_precheck_cmd").val();
mm_precheck_cmd = $("#mm_precheck_cmd").val();

p2_mm_aso_file = $("#p2_mm_aso_file").val();
p2_mm_aso_file = p2_mm_aso_file.trim()
p2_mm_aso_version = $("#p2_mm_aso_version").val();
p2_mm_aso_build = $("#p2_mm_aso_build").val();

p2_md_aso_file = $("#p2_md_aso_file").val();
p2_md_aso_file = p2_md_aso_file.trim()
p2_md_aso_version = $("#p2_md_aso_version").val();
p2_md_aso_build = $("#p2_md_aso_build").val();

p2_hosts_uname = $("#p2_hosts_uname").val();
p2_hosts_password = $("#p2_hosts_password").val();
p2_hosts_password2 = $("#p2_hosts_password2").val();

v_c_u_b_u = $("#v_c_u_b_u").prop("checked");
v_c_s_b_u = $("#v_c_s_b_u").prop("checked");
b_f_b_u = $("#b_f_b_u").prop("checked");
b_c_b_u = $("#b_c_b_u").prop("checked");
b_l_b_u = $("#b_l_b_u").prop("checked");



 if(p2_mm_aso_file.match("ArubaOS_.?MM_.*_.\d*") == null)
      {$("#save_danger").text("Please provide valid MM AOS file");return "";}

if(p2_md_aso_file.match("ArubaOS_.?MC_.*_.\d*") == null)
      {$("#save_danger").text("Please provide valid MD AOS file");return "";}

 if(max_ap_preload < 1)
      {$("#save_danger").text("MAX AP preload must be greater than one");return "";}

   if(p2_mm_aso_file.length < 1)
      {$("#save_danger").text("Please provide valid MM AOS filename");return "";}

   if(p2_md_aso_file.length < 1)
      {$("#save_danger").text("Please provide valid MD AOS filename");return "";}

   if(p2_hosts_uname.length < 1)
      {$("#save_danger").text("Please provide valid device username");return "";}

    if(p2_hosts_password.length < 1)
      {$("#save_danger").text("Please provide valid device password");return "";}

    if(p2_hosts_password != p2_hosts_password2)
      {$("#save_danger").text("Host Password not matched");return "";}

    if(p2_md_aso_version.length < 1)
      {$("#save_danger").text("Please provide valid MD AOS Version");return "";}

    if(p2_md_aso_build.length < 1)
      {$("#save_danger").text("Please provide valid MD AOS build");return "";}

    if(p2_mm_aso_version.length < 1)
      {$("#save_danger").text("Please provide valid MM AOS Version");return "";}

    if(p2_mm_aso_build.length < 1)
      {$("#save_danger").text("Please provide valid MM AOS build");return "";}



md_precheck_cmd_n = md_precheck_cmd.split("\n");
md_precheck_cmd = []
jQuery.each(md_precheck_cmd_n, function(i, val){

md_precheck_cmd.push({"show":val});

});

mm_precheck_cmd_n = mm_precheck_cmd.split("\n");
mm_precheck_cmd = []
jQuery.each(mm_precheck_cmd_n, function(i, val){

mm_precheck_cmd.push({"show":val});

});


all_devices = [];
all_tr = $("#p2_new_host_rows").find('> tr');

for (i = 0; i < all_tr.length; i++)
{
  val = all_tr[i]
  //Get all the devices and add it to this
  if (i > 0)
  {

  //Single host tr
  row = val.id.split("_")[0];
  row_device = row+"_"+"device";
  row_hostname = row+"_"+"hostname";
  row_hostip = row+"_"+"hostip";

  device_type = $("#"+row_device).val();
  hostname = $("#"+row_hostname).val();
  host = $("#"+row_hostip).val();
  
  if(device_type.length < 1)
      {$("#save_danger").text("Please provide Valid device type");return "no";}

  if(hostname.length < 1)
      {$("#save_danger").text("Please provide Valid hostname");return "no";}

  if(host.length < 1)
      {$("#save_danger").text("Please provide Valid host IP");return "no";}

  all_devices.push({"device_type":device_type,"hostname":hostname,"host":host})

  }}

MM = {"image_file_name":p2_mm_aso_file,"image_version":p2_mm_aso_version,"image_build":p2_mm_aso_build,"upgrade_disk": "Auto","CheckList":mm_precheck_cmd}

MD = {"image_file_name":p2_md_aso_file,"image_version":p2_md_aso_version,"image_build":p2_md_aso_build,"upgrade_disk": "Auto","CheckList":md_precheck_cmd,"Pre_image_AP":true,"max_ap_image_load":max_ap_preload}





//Start
upgrade_json = {"Upgrade":all_devices,"default_settings":{
  "AOS_Source":AOS_Source,
  "MM":MM,
  "MD":MD,
  "Authentication":{"username":p2_hosts_uname,"password":p2_hosts_password},
  "Validate_controller_sync_before_upgrade":v_c_s_b_u,
  "Validate_controller_up_before_upgrade": v_c_u_b_u,
  "Validate_Image_before_upgrade": true
}
}//End

console.log(upgrade_json);
jdata = {"config_name":file_name,"config_json":upgrade_json}

$.ajax({
    type: 'POST',data:JSON.stringify(jdata),url: '/portal/save_config',contentType: "application/json",dataType: 'json',    
    success:function(results){
      console.log(results);
      res_results = results["results"];

      message = results["message"];
      data = results["data"];

      if (res_results == "success"){
        alert(data);
        //$('#save_suc_alert').alert();
        //$("#save_success_alrt").val(data);
        console.log(data);

      }else if (res_results == "error"){

        alert(data);
      //$('#save_fai_alert').alert();
      //$("#save_success_alrt").val(data);
      console.log(data);

      }else if (res_results == "failed"){

        //$('#save_fai_alert').alert();
        alert("Failed to save");
        //$("#save_failed_alrt").val("Failed to save");
        console.log(data);
      }


    } ,error: function(xhr, ajaxOptions, thrownError){

      console.log("** Error save_config");


    }});

console.log(upgrade_json)


}



// Creating new execution 
function new_execution(conf_file="default.yaml"){

// Reset the page 2 form
reset_settings();
console.log("Page-2 init....");
dev_id = 0;

// Reading default template from server
fname_down = "/portal/read_config?config_name="+conf_file;
$(function(){
    $.ajax({
        url: fname_down,
        async: true,   // asynchronous request? (synchronous requests are discouraged...)
        cache: false,   // with this, you can force the browser to not make cache of the retrieved data
        dataType: "json",  // jQuery will infer this, but you can set explicitly
        success: function( data, textStatus, jqXHR ) {
          add_data_to_execution_form(data);
        },
        error(xhr,status,error){
          console.log("read_config error.....");
          console.log(error);
        }
    });
});


}


function delete_device(delete_id){
console.log("Deleting:"+delete_id);
$("#"+delete_id).remove()

}


function add_new_device(caller_id,d){

console.log("Adding new device...");

dev_id = dev_id + 1;


new_dev = new_device_list(dev_id,d);
//console.log(new_dev);
val = caller_id-1

console.log("Adding:"+dev_id+"-After -->"+val);

if(caller_id == 1){

$('#p2_new_host_row').eq(caller_id-1).after(new_dev);

}

else{

$(new_dev).insertAfter("#"+caller_id);

}

console.log("Done...");


}


// Upload host to Excell

function host_excell_upload(){

console.log("showing excell form...")
$("#p2_excell_upload").modal({backdrop: "static"})

}


// Custome setting show

function custome_settings(){

$("#p2_custome_setting").modal({backdrop: "static"})

}


// Custome setting show

function host_settings(host_list_id){

$("#p2_host_setting").modal({backdrop: "static"})

}


function manage_poa_list(poa_action)

{



f_name = $("#select_poa").val();
$("#manage_poa_msg").text("");

if (poa_action == "list"){
  $("#manage_file").modal({backdrop: "static"})
  $('#select_poa').find('option').remove();
  poa_url = '/portal/manage_file'
}

if (poa_action == "delete"){
  if(confirm('Are you sure you want to delete POA :'+f_name+' ?')){
    poa_url = '/portal/manage_file?type=delete&file_name='+f_name;
  }else{

    console.log("User say no to delete");
  }
  
}

if (poa_action == "download"){
  poa_url = '/portal/manage_file?type=download&file_name='+f_name;
  window.open(poa_url, 'name'); 
  return "";
}

if (poa_action == "edit"){

$("#manage_file").modal('hide');
new_execution(f_name);
return "";

}

$.ajax({
    type: 'GET',url: poa_url,contentType: false,cache: false,processData:false,
    success:function(results){
      console.log(results);
      status = results["status"]
      msg = results["message"]
      $("#manage_poa_msg").text(msg);
      current_files = results["current_files"]
      if (jQuery.isEmptyObject(current_files) == false){
      $('#select_poa').find('option').remove();
      jQuery.each(current_files,function(i, val){
        $('#select_poa').append('<option value="'+val+'">'+val+'</option>');
      });
    }


    } ,error: function(xhr, ajaxOptions, thrownError){


      console.log("** Getting job files failed for URL : /portal/manage_file");


    }});



}



function start_upgrade(){

try{
upgrade();
console.log("start_upgrade clicked...")
$("#select_upgrade").modal({backdrop: "static"});
$("#start_new_upgrade_badge").text("");
$("#start_new_upgrade_bold").text("Start Upgrade");

$('#job_file_list').find('option').not(':first').remove();
$('#precheck_only').prop("checked",false);




// Get job name from server

$.ajax({
    type: 'GET',url: '/portal/manage_file',contentType: false,cache: false,processData:false,
    success:function(results){

      status = results["status"]
      current_files = results["current_files"]
      if (jQuery.isEmptyObject(current_files) == false){

      jQuery.each(current_files,function(i, val){

        $('#job_file_list').append('<option value="'+val+'">'+val+'</option>');
      });
    }


    } ,error: function(xhr, ajaxOptions, thrownError){


      console.log("** Getting job files faile for URL : /portal/manage_file");


    }});

}catch(e){console.log("** start_upgrade error");console.log(e);}



}



//////////// PAGE-2 START NEW UPGRADE ///////////////////////////////

function start_new_upgrade(){

job_name = $("#job_file_list").val();
pre_check = $('#precheck_only').prop("checked");
//console.log(job_name);
if (job_name == "none"){

$("#start_new_upgrade_badge").attr('class', 'badge badge-danger');
$("#start_new_upgrade_badge").text("Please select the POA");

}else{

$("#start_new_upgrade_badge").attr('class', 'badge badge-info');
$("#start_new_upgrade_badge").text("Please Wait");

if (pre_check == true){job_list="Precheck";}else{job_list="Upgrade";}
jdata = {"file_name":job_name,"job_list":job_list}


$.ajax({
    type: 'POST',data:JSON.stringify(jdata),url: '/portal/start_execution',contentType: "application/json",dataType: 'json',    
    success:function(results){
      console.log("Received response for new job execution...");
      //console.log(results);
      res_results = results["results"];

      message = results["message"];

      if (res_results == "success"){

        $("#start_new_upgrade_badge").attr('class', 'badge badge-success');
        $("#start_new_upgrade_badge").text(message);
        $("#select_upgrade").modal('toggle');


      }else if (res_results == "error"){


        $("#start_new_upgrade_badge").attr('class', 'badge badge-danger');
        $("#start_new_upgrade_badge").text(message);

      }else if (res_results == "failed"){

        $("#start_new_upgrade_badge").attr('class', 'badge badge-danger');
        $("#start_new_upgrade_badge").text(message);

      }


    } ,error: function(xhr, ajaxOptions, thrownError){


      $("#start_new_upgrade_badge").attr('class', 'badge badge-danger');
      $("#start_new_upgrade_badge").text("Failed to reach...");
      console.log("** Starting new job failed....");


    }});


}

}


// Auto detect MM , MD version and build from image file
$(document).ready(function() {

$("#p2_mm_aso_file").change(function(){
mm_file = $("#p2_mm_aso_file").val();
mm_file_version = mm_file.split("_").slice(-2)[0]
mm_file_build = mm_file.split("_").slice(-1)[0]
$("#p2_mm_aso_version").val(mm_file_version);
$("#p2_mm_aso_build").val(mm_file_build);
});


$("#p2_md_aso_file").change(function(){
md_file = $("#p2_md_aso_file").val();
md_file_version = md_file.split("_").slice(-2)[0]
md_file_build = md_file.split("_").slice(-1)[0]
$("#p2_md_aso_version").val(md_file_version);
$("#p2_md_aso_build").val(md_file_build);
});

})

//////////////// PAGE -2 END ////////////////////////////////////////////// 



//////////////// PAGE -3 START ////////////////////////////////////////////

// Displaing execution history
function show_history(){

console.log("Page-3 init....");
$(".upgrade_class").hide();
$(".new_execution_class").hide();
$(".report_class").show();

$("#upgrade").attr('class', 'btn btn-outline-primary');
$("#new_execution").attr('class', 'btn btn-outline-primary dropdown-toggle');
$("#history").attr('class', 'btn btn-outline-primary active');

}


function modify_history_table_data( json ) 
{

try{
  console.log("Reding history response...")
  //console.log(json);
 
   // for ( var i=0, ien=json.length ; i<ien ; i++ ) 
    //{
    //    json[i][0] = '<a href="/message/'+json[i][0]+'>View message</a>';
      
    //}
  only_data = json["data"]
  if (jQuery.isEmptyObject(only_data) == false){
      //console.log(only_data);
      jQuery.each(only_data, function(i, val){
      evnt_msg = val[3];
      pre_report = "/portal/get_report?job_name="+val[1]+"&report_name=Precheck.html"
      post_report = "/portal/get_report?job_name="+val[1]+"&report_name=Upgrade.html"
      log_files = "/portal/get_report?job_name="+val[1]+"&report_name=all_logs"

      val[8] = '<a href='+pre_report+' target="_blank">Precheck</a><br>' + '<a href='+post_report+' target="_blank">Upgrade</a><br>' + '<a href='+log_files+' target="_blank">Log files</a>'
      style_val = 'style="text-align:left;white-space=nowrap"'
      if (evnt_msg.indexOf("ERROR") == 0)
      {

        //val[0] = '<span class="badge badge-danger"'+style_val+'>'+val[0]+'</span>'
        //val[1] = '<span class="badge badge-danger"'+style_val+'>'+val[1]+'</span>'
        //val[2] = '<span class="badge badge-danger"'+style_val+'>'+val[2]+'</span>'
        val[3] = '<span class="badge badge-danger"'+style_val+'>'+val[3]+'</span>'
         //val[4] = '<span class="badge badge-danger"'+style_val+'>'+val[4]+'</span>'
         //val[5] = '<span class="badge badge-danger"'+style_val+'>'+val[5]+'</span>'
         //val[6] = '<span class="badge badge-danger"'+style_val+'>'+val[6]+'</span>'

      }else if (evnt_msg.indexOf("RUNNING") == 0){

        //val[0] = '<span class="badge badge-warning"'+style_val+'>'+val[0]+'</span>'
        //val[1] = '<span class="badge badge-warning"'+style_val+'>'+val[1]+'</span>'
        //val[2] = '<span class="badge badge-warning"'+style_val+'>'+val[2]+'</span>'
        val[3] = '<span class="badge badge-warning"'+style_val+'>'+val[3]+'</span>'
        // val[4] = '<span class="badge badge-warning"'+style_val+'>'+val[4]+'</span>'
         //val[5] = '<span class="badge badge-warning"'+style_val+'>'+val[5]+'</span>'
         //val[6] = '<span class="badge badge-warning"'+style_val+'>'+val[6]+'</span>'


      }else if (evnt_msg.indexOf("COMPLETED") == 0){

       // val[0] = '<span class="badge badge-success"'+style_val+'>'+val[0]+'</span>'
        //val[1] = '<span class="badge badge-success"'+style_val+'>'+val[1]+'</span>'
        //val[2] = '<span class="badge badge-success"'+style_val+'>'+val[2]+'</span>'
        val[3] = '<span class="badge badge-success"'+style_val+'>'+val[3]+'</span>'
        // val[4] = '<span class="badge badge-success"'+style_val+'>'+val[4]+'</span>'
         //val[5] = '<span class="badge badge-success"'+style_val+'>'+val[5]+'</span>'
         //val[6] = '<span class="badge badge-success"'+style_val+'>'+val[6]+'</span>'

        
      }else{

         //val[0] = '<span class="badge badge-info"'+style_val+'>'+val[0]+'</span>'
        //val[1] = '<span class="badge badge-info"'+style_val+'>'+val[1]+'</span>'
        //val[2] = '<span class="badge badge-info"'+style_val+'>'+val[2]+'</span>'
        val[3] = '<span class="badge badge-info"'+style_val+'>'+val[3]+'</span>'
        // val[4] = '<span class="badge badge-info"'+style_val+'>'+val[4]+'</span>'
         //val[5] = '<span class="badge badge-info"'+style_val+'>'+val[5]+'</span>'
         //val[6] = '<span class="badge badge-info"'+style_val+'>'+val[6]+'</span>'


      }

      });
      return only_data;

  }
else{
  console.log("Job history data not")
  console.log(json);
  return [];
}

}catch(e){console.log("Receiving history error");return [];}}

$(document).ready(function() {
    jobs_table = $('#history_table').DataTable( {
        columns: [
            { title: "ID" },
            { title: "Name" },
            { title: "Configuration" },
            { title: "Status" },
            { title: "Start Date" },
            { title: "Completed Date" },
            { title: "Note" },
            { title: "Execution" },
            { title: "Download Report" }
        ],
        "scrollY":        "350px",
        "columnDefs": [{ "visible": false, "targets": [1] }],
        "scrollCollapse": true,
        "responsive":true,
        "paging":         false,
        //"order": [[ 0, "desc" ]],
        "ajax": {
        "url": "/portal/read_all_jobs",
        "type": "GET",
        "dataSrc": modify_history_table_data,
        },
      
      });

} );


function import_from_csv()
{
console.log("reading csv....");
csv_file_data = $("#csv_file").prop('files')[0];
console.log(csv_file_data);

Papa.parse(csv_file_data,{
  config: {
    // base config to use for each file
  },
  before: function(file, inputElem)
  {

    $("#csv_import_status").attr('class', 'badge badge-success');
    $("#csv_import_status").text("Uploading...");
    console.log("parsing csv....");
    // executed before parsing each file begins;
    // what you return here controls the flow
  },
  error: function(err, file, inputElem, reason)
  {
    // executed if an error occurs while loading the file,
    // or if before callback aborted for some reason
    $("#csv_import_status").attr('class', 'badge badge-danger');
    $("#csv_import_status").text(reason);
  },
  complete: function(results)
  {
    // executed after all files are complete
    $("#csv_import_status").attr('class', 'badge badge-success');
    $("#csv_import_status").text("Uploaded...");
    console.log(results);
  }
});



}


//////////////// PAGE -3 END ////////////////////////////////////////////




setInterval(get_server_status,3000)

setInterval( function () {execution_table.ajax.reload( null, false );}, 3000 );
setInterval( function () {events_table.ajax.reload( null, false );}, 3000 );
setInterval( function () {jobs_table.ajax.reload( null, false );}, 5000 );
setInterval(async_get_events,3000);

</script>



</body>
</html>

